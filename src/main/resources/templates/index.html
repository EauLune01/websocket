<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>사용자 선택</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        body{font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Noto Sans KR,Segoe UI,Roboto,sans-serif;margin:0;background:#0e1117;color:#e6edf3}
        .wrap{max-width:720px;margin:48px auto;padding:0 16px}
        .card{background:#161b22;border:1px solid #2b313c;border-radius:16px;padding:18px}
        select,button{padding:10px;border-radius:12px;border:1px solid #2b313c;background:#0c1220;color:#e6edf3}
        label{display:block;margin:10px 0 6px;color:#9aa4b2}
        .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
        button:hover { background:#1f2733; cursor:pointer; }
    </style>
</head>
<body>
<div class="wrap">
    <h2>실시간 채팅 · 사용자 선택</h2>
    <div class="card">
        <div class="row">
            <div style="flex:1">
                <label>나 (user)</label>
                <select id="me">
                    <option value="">-- 나를 선택하세요 --</option>
                    <option th:each="u : ${users}"
                            th:value="${u.uid}"
                            th:text="${u.displayName} + ' (' + ${u.key} + ')'">
                    </option>
                </select>
            </div>
            <div style="flex:1">
                <label>상대</label>
                <select id="peer">
                    <option th:each="u : ${users}"
                            th:value="${u.uid}"
                            th:text="${u.displayName} + ' (' + ${u.key} + ')'">
                    </option>
                </select>
            </div>
        </div>
        <div style="margin-top:14px" class="row">
            <button id="enter">입장</button>
        </div>
    </div>
</div>

<script>
    document.getElementById('enter').addEventListener('click', ()=>{
      const meSel   = document.getElementById('me');
      const peerSel = document.getElementById('peer');
      const meUid   = meSel.value;
      const peerUid = peerSel.value;

      if(!meUid || !peerUid){ alert('사용자를 선택하세요.'); return; }
      if(meUid === peerUid){ alert('서로 다른 사용자를 선택하세요.'); return; }

      // ✅ roomId는 uid 두 개를 정렬 후 결합 → 항상 고유/안정
      const room = [meUid, peerUid].sort().join('__');
      location.href = `/chat?userUid=${encodeURIComponent(meUid)}&room=${encodeURIComponent(room)}`;
    });
</script>
</body>
</html>


